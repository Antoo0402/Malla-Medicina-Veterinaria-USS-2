<script>
const mallaCompleta = [
  {
    semestre: "1er Semestre",
    cursos: [
      { nombre: "Biología celular", requisitos: [] },
      { nombre: "Química General y Orgánico", requisitos: [] },
      { nombre: "Física Médica", requisitos: [] },
      { nombre: "Matemáticas", requisitos: [] },
      { nombre: "Orientación profesional", requisitos: [] },
      { nombre: "Estrategia para el aprendizaje", requisitos: [] }
    ]
  },
  {
    semestre: "2do Semestre",
    cursos: [
      { nombre: "Bioquímica General", requisitos: ["Biología celular", "Química General y Orgánico"] },
      { nombre: "Anatomía Veterinaria 1", requisitos: ["Biología celular"] },
      { nombre: "Histología Veterinaria", requisitos: ["Biología celular"] },
      { nombre: "Zoología Veterinaria", requisitos: [] },
      { nombre: "Bienestar animal", requisitos: ["Orientación profesional"] },
      { nombre: "Inglés Instrumental 1", requisitos: [] }
    ]
  },
  {
    semestre: "3er Semestre",
    cursos: [
      { nombre: "Antropología", requisitos: [] },
      { nombre: "Ecología", requisitos: ["Zoología Veterinaria"] },
      { nombre: "Fisiología Animal", requisitos: ["Bioquímica General", "Histología Veterinaria", "Bienestar animal"] },
      { nombre: "Anatomía Veterinaria 2", requisitos: ["Anatomía Veterinaria 1"] },
      { nombre: "Microbiología General", requisitos: ["Bioquímica General"] },
      { nombre: "Inmunología", requisitos: ["Histología Veterinaria", "Bienestar animal"] },
      { nombre: "Genética Ganadera", requisitos: ["Biología celular", "Matemáticas"] },
      { nombre: "Inglés Instrumental 2", requisitos: ["Inglés Instrumental 1"] }
    ]
  }
  // Continúa con los otros semestres agregando requisitos
];

const state = {
  aprobadas: JSON.parse(localStorage.getItem('materiasAprobadas')) || {},
  totalCursos: mallaCompleta.reduce((total, sem) => total + sem.cursos.length, 0)
};

document.addEventListener('DOMContentLoaded', () => {
  renderMalla();
});

function renderMalla() {
  const container = document.getElementById('malla');
  container.innerHTML = '';

  mallaCompleta.forEach(sem => {
    const col = document.createElement('div');
    col.className = 'semestre';

    const titulo = document.createElement('h2');
    titulo.textContent = sem.semestre;
    col.appendChild(titulo);

    sem.cursos.forEach(curso => {
      const div = document.createElement('div');
      div.className = 'curso';
      div.textContent = curso.nombre;
      div.dataset.nombre = curso.nombre;

      if (!estaDisponible(curso)) div.classList.add('bloqueado');
      if (state.aprobadas[curso.nombre]) div.classList.add('aprobado');

      div.addEventListener('click', () => {
        if (div.classList.contains('bloqueado')) return;
        toggleCurso(curso.nombre);
      });

      col.appendChild(div);
    });

    container.appendChild(col);
  });
}

function estaDisponible(curso) {
  if (curso.requiereTodo) {
    const totalRequerido = state.totalCursos - 4;
    return Object.keys(state.aprobadas).length >= totalRequerido;
  }

  if (!curso.requisitos || curso.requisitos.length === 0) return true;
  return curso.requisitos.every(req => state.aprobadas[req]);
}

function toggleCurso(nombre) {
  if (state.aprobadas[nombre]) {
    delete state.aprobadas[nombre];
  } else {
    state.aprobadas[nombre] = true;
  }
  localStorage.setItem('materiasAprobadas', JSON.stringify(state.aprobadas));
  renderMalla();
}
</script>
